name: production-training-app
services:
    api:
        build:
            context: /home/sebastien/production-training-app/services/api-ts
            dockerfile: Dockerfile
        cpu_shares: 90
        command: []
        depends_on:
            db:
                condition: service_started
                required: true
        deploy:
            resources:
                limits:
                    memory: "12443451392"
        environment:
            DATABASE_URL: postgresql://devuser:Sebastien2106@db:5432/fitness_data
        image: ghcr.io/sebastiendesalle/trainingdevopsplan-api:latest
        labels:
            traefik.enable: "true"
            traefik.http.routers.api.rule: PathPrefix(`/api`)
            traefik.http.services.api.loadbalancer.server.port: "3000"
        networks:
            default: null
        restart: unless-stopped
    db:
        cpu_shares: 90
        command: []
        deploy:
            resources:
                limits:
                    memory: "12443451392"
        environment:
            POSTGRES_DB: fitness_data
            POSTGRES_PASSWORD: Sebastien2106
            POSTGRES_USER: devuser
        image: postgres:15
        networks:
            default: null
        restart: unless-stopped
        volumes:
            - type: bind
              source: /home/sebastien/production-training-app/postgres_data
              target: /var/lib/postgresql/data
              bind:
                create_host_path: true
    traefik:
        cpu_shares: 90
        command:
            - --providers.docker=true
            - --api.insecure=true
        container_name: traefik
        deploy:
            resources:
                limits:
                    memory: "12443451392"
        hostname: traefik
        image: traefik:v3.0
        networks:
            default: null
        ports:
            - mode: ingress
              target: 80
              published: "8080"
              protocol: tcp
            - mode: ingress
              target: 443
              published: "443"
              protocol: tcp
            - mode: ingress
              target: 8080
              published: "8081"
              protocol: tcp
        restart: unless-stopped
        volumes:
            - type: bind
              source: /var/run/docker.sock
              target: /var/run/docker.sock
              read_only: true
              bind:
                create_host_path: true
    web:
        build:
            context: /home/sebastien/production-training-app/frontend
            dockerfile: Dockerfile
        cpu_shares: 90
        command: []
        deploy:
            resources:
                limits:
                    memory: "12443451392"
        image: ghcr.io/sebastiendesalle/trainingdevopsplan-web:latest
        labels:
            traefik.enable: "true"
            traefik.http.routers.web.rule: PathPrefix(`/`)
        networks:
            default: null
        restart: unless-stopped
    worker:
        build:
            context: /home/sebastien/production-training-app/services/worker-ts
            dockerfile: Dockerfile
        cpu_shares: 90
        command: []
        depends_on:
            db:
                condition: service_started
                required: true
        deploy:
            resources:
                limits:
                    memory: "12443451392"
        environment:
            DATABASE_URL: postgresql://devuser:Sebastien2106@db:5432/fitness_data
            GARMIN_PASS: Sebastien2106
            GARMIN_USER: desallesebastien@gmail.com
        image: ghcr.io/sebastiendesalle/trainingdevopsplan-worker:latest
        labels:
            traefik.enable: "false"
        networks:
            default: null
        restart: unless-stopped
networks:
    default:
        name: production-training-app_default
x-casaos:
    author: self
    category: self
    hostname: ""
    icon: ""
    index: /
    is_uncontrolled: false
    port_map: "8080"
    scheme: http
    title:
        custom: Training APP
